openapi: 3.0.3
info:
  title: RTO Compliance Hub API
  version: 1.0.0
  description: |
    REST API for RTO (Registered Training Organization) Compliance Management & Governance Platform.
    
    This platform provides comprehensive compliance tracking, governance documentation, training product management,
    professional development tracking, feedback collection, and resource management for RTOs.
    
    ## Features
    - **Governance**: Manage policies, procedures, and compliance documentation
    - **Training Products**: Track training courses, SOPs, and assessment materials
    - **Feedback Management**: Collect and analyze learner, employer, and industry feedback
    - **Professional Development**: Track staff credentials and PD requirements
    - **Resource Management**: Manage assets, infrastructure, and learning resources
    - **Complaints & Appeals**: Workflow-driven complaint handling
    - **Compliance Tracking**: Map standards to policies and evidence
    
    ## Authentication
    All authenticated endpoints require a valid JWT Bearer token in the Authorization header.
    Use the `/api/v1/auth/login` endpoint to obtain a token.
    
    ## Rate Limiting
    - Authentication endpoints: 5 requests per 15 minutes per IP
    - Password reset endpoints: 3 requests per hour per IP
    - General API endpoints: 100 requests per 15 minutes per IP
    - Webhook endpoints: 30 requests per minute
    
    ## Error Handling
    All errors follow RFC 7807 Problem Details format with the following structure:
    ```json
    {
      "type": "https://tools.ietf.org/html/rfc7231#section-6.5.1",
      "title": "Bad Request",
      "status": 400,
      "detail": "Detailed error message",
      "instance": "/api/v1/resource"
    }
    ```
    
  contact:
    name: RTO Compliance Hub Support
    email: support@rtocompliancehub.com
  license:
    name: Proprietary
    
servers:
  - url: http://localhost:3000
    description: Development server
  - url: https://staging-api.rtocompliancehub.com
    description: Staging server
  - url: https://api.rtocompliancehub.com
    description: Production server

security:
  - bearerAuth: []

tags:
  - name: Authentication
    description: User authentication and session management
  - name: Users
    description: User management and profiles
  - name: Policies
    description: Policy and governance documentation management
  - name: Standards
    description: RTO compliance standards and mappings
  - name: Training Products
    description: Training course and product management
  - name: SOPs
    description: Standard Operating Procedures
  - name: Professional Development
    description: Staff PD tracking and credentials
  - name: Credentials
    description: Staff credentials and certifications
  - name: Feedback
    description: Learner, employer, and industry feedback collection
  - name: Assets
    description: Asset and resource management
  - name: Complaints
    description: Complaints and appeals workflow
  - name: Onboarding
    description: Staff onboarding workflows
  - name: Reports
    description: Export and reporting functionality
  - name: Jobs
    description: Background job management
  - name: Audit Logs
    description: System audit logging
  - name: Monitoring
    description: System monitoring and health checks
  - name: Webhooks
    description: Webhook integrations (JotForm, etc.)
  - name: Integrations
    description: Third-party integrations (Xero, Accelerate, Google Drive)

paths:
  /api/v1/auth/login:
    post:
      tags:
        - Authentication
      summary: Login user
      description: Authenticate user with email and password and receive JWT tokens
      operationId: login
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  format: email
                  example: user@example.com
                password:
                  type: string
                  format: password
                  example: SecurePassword123!
            examples:
              valid:
                summary: Valid login credentials
                value:
                  email: admin@rto.com.au
                  password: AdminPass123!
      responses:
        '200':
          description: Login successful
          headers:
            Set-Cookie:
              schema:
                type: string
              description: Refresh token cookie (httpOnly, secure)
          content:
            application/json:
              schema:
                type: object
                properties:
                  access_token:
                    type: string
                    description: JWT access token (15 minute expiry)
                  token_type:
                    type: string
                    example: Bearer
                  expires_in:
                    type: integer
                    description: Token expiry in seconds
                    example: 900
                  user:
                    $ref: '#/components/schemas/User'
              examples:
                success:
                  summary: Successful login
                  value:
                    access_token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
                    token_type: Bearer
                    expires_in: 900
                    user:
                      id: 550e8400-e29b-41d4-a716-446655440000
                      name: John Smith
                      email: admin@rto.com.au
                      department: Management
                      roles: [SystemAdmin]
                      status: Active
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '429':
          $ref: '#/components/responses/TooManyRequestsError'
          
  /api/v1/auth/logout:
    post:
      tags:
        - Authentication
      summary: Logout user
      description: Logout user and invalidate refresh token
      operationId: logout
      responses:
        '200':
          description: Logout successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Logged out successfully
        '401':
          $ref: '#/components/responses/UnauthorizedError'
          
  /api/v1/auth/refresh:
    post:
      tags:
        - Authentication
      summary: Refresh access token
      description: Get a new access token using refresh token cookie
      operationId: refreshToken
      security: []
      responses:
        '200':
          description: Token refreshed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  access_token:
                    type: string
                  token_type:
                    type: string
                    example: Bearer
                  expires_in:
                    type: integer
                    example: 900
        '401':
          $ref: '#/components/responses/UnauthorizedError'
          
  /api/v1/auth/change-password:
    post:
      tags:
        - Authentication
      summary: Change password
      description: Change password for authenticated user
      operationId: changePassword
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - currentPassword
                - newPassword
              properties:
                currentPassword:
                  type: string
                  format: password
                newPassword:
                  type: string
                  format: password
                  minLength: 8
      responses:
        '200':
          description: Password changed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Password changed successfully
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
          
  /api/v1/auth/reset-password:
    post:
      tags:
        - Authentication
      summary: Request password reset
      description: Request password reset email or complete reset with token
      operationId: resetPassword
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              oneOf:
                - type: object
                  required:
                    - email
                  properties:
                    email:
                      type: string
                      format: email
                - type: object
                  required:
                    - token
                    - newPassword
                  properties:
                    token:
                      type: string
                    newPassword:
                      type: string
                      format: password
      responses:
        '200':
          description: Reset email sent or password reset successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
        '400':
          $ref: '#/components/responses/BadRequestError'
        '429':
          $ref: '#/components/responses/TooManyRequestsError'
          
  /api/v1/users:
    get:
      tags:
        - Users
      summary: List users
      description: Get paginated list of users with optional filters
      operationId: listUsers
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/PerPageParam'
        - name: department
          in: query
          schema:
            $ref: '#/components/schemas/Department'
        - name: role
          in: query
          schema:
            $ref: '#/components/schemas/Role'
        - name: status
          in: query
          schema:
            $ref: '#/components/schemas/UserStatus'
        - name: q
          in: query
          description: Search query (name or email)
          schema:
            type: string
      responses:
        '200':
          description: List of users
          content:
            application/json:
              schema:
                type: object
                properties:
                  users:
                    type: array
                    items:
                      $ref: '#/components/schemas/User'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
          
    post:
      tags:
        - Users
      summary: Create user
      description: Create a new user account
      operationId: createUser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserCreate'
      responses:
        '201':
          description: User created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
          
  /api/v1/users/{id}:
    get:
      tags:
        - Users
      summary: Get user
      description: Get user details by ID
      operationId: getUser
      parameters:
        - $ref: '#/components/parameters/IdParam'
      responses:
        '200':
          description: User details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '404':
          $ref: '#/components/responses/NotFoundError'
          
    patch:
      tags:
        - Users
      summary: Update user
      description: Update user details
      operationId: updateUser
      parameters:
        - $ref: '#/components/parameters/IdParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserUpdate'
      responses:
        '200':
          description: User updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '404':
          $ref: '#/components/responses/NotFoundError'
          
    delete:
      tags:
        - Users
      summary: Delete user
      description: Soft delete user (set status to Inactive)
      operationId: deleteUser
      parameters:
        - $ref: '#/components/parameters/IdParam'
      responses:
        '204':
          description: User deleted successfully
        '404':
          $ref: '#/components/responses/NotFoundError'
          
  /api/v1/users/{id}/credentials:
    post:
      tags:
        - Users
      summary: Add credential to user
      description: Add a credential or certification to user profile
      operationId: addUserCredential
      parameters:
        - $ref: '#/components/parameters/IdParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CredentialCreate'
      responses:
        '201':
          description: Credential added successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Credential'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '404':
          $ref: '#/components/responses/NotFoundError'
          
  /api/v1/users/{id}/pd:
    get:
      tags:
        - Users
      summary: Get user PD items
      description: Get professional development items for a user
      operationId: getUserPDItems
      parameters:
        - $ref: '#/components/parameters/IdParam'
        - name: status
          in: query
          schema:
            $ref: '#/components/schemas/PDStatus'
      responses:
        '200':
          description: List of PD items
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/PDItem'
        '404':
          $ref: '#/components/responses/NotFoundError'
          
  /api/v1/policies:
    get:
      tags:
        - Policies
      summary: List policies
      description: Get paginated list of policies with optional filters
      operationId: listPolicies
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/PerPageParam'
        - name: standardId
          in: query
          description: Filter by standard ID
          schema:
            type: string
        - name: status
          in: query
          schema:
            $ref: '#/components/schemas/PolicyStatus'
      responses:
        '200':
          description: List of policies
          content:
            application/json:
              schema:
                type: object
                properties:
                  policies:
                    type: array
                    items:
                      $ref: '#/components/schemas/Policy'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
                    
    post:
      tags:
        - Policies
      summary: Create policy
      description: Create a new policy document
      operationId: createPolicy
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PolicyCreate'
      responses:
        '201':
          description: Policy created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Policy'
                
  /api/v1/policies/export:
    get:
      tags:
        - Policies
      summary: Export policies
      description: Export policies as CSV
      operationId: exportPolicies
      parameters:
        - name: format
          in: query
          schema:
            type: string
            enum: [csv, pdf]
            default: csv
      responses:
        '200':
          description: Export file
          content:
            text/csv:
              schema:
                type: string
            application/pdf:
              schema:
                type: string
                format: binary
                
  /api/v1/policies/{id}:
    get:
      tags:
        - Policies
      summary: Get policy
      description: Get policy details including version history
      operationId: getPolicy
      parameters:
        - $ref: '#/components/parameters/IdParam'
      responses:
        '200':
          description: Policy details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Policy'
                
    patch:
      tags:
        - Policies
      summary: Update policy
      description: Update policy metadata
      operationId: updatePolicy
      parameters:
        - $ref: '#/components/parameters/IdParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PolicyUpdate'
      responses:
        '200':
          description: Policy updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Policy'
                
  /api/v1/policies/{id}/publish:
    post:
      tags:
        - Policies
      summary: Publish policy version
      description: Publish a new version of the policy
      operationId: publishPolicy
      parameters:
        - $ref: '#/components/parameters/IdParam'
      responses:
        '200':
          description: Policy published successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Policy'
                
  /api/v1/policies/{id}/map:
    post:
      tags:
        - Policies
      summary: Map policy to standards
      description: Link policy to compliance standards
      operationId: mapPolicyToStandards
      parameters:
        - $ref: '#/components/parameters/IdParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - standardIds
              properties:
                standardIds:
                  type: array
                  items:
                    type: string
                  example: ['STD-1', 'STD-2']
      responses:
        '200':
          description: Mapping updated successfully
          
  /api/v1/policies/{id}/versions:
    get:
      tags:
        - Policies
      summary: Get policy versions
      description: Get version history for a policy
      operationId: getPolicyVersions
      parameters:
        - $ref: '#/components/parameters/IdParam'
      responses:
        '200':
          description: Policy version history
          content:
            application/json:
              schema:
                type: object
                properties:
                  versions:
                    type: array
                    items:
                      $ref: '#/components/schemas/PolicyVersion'
                      
  /api/v1/standards:
    get:
      tags:
        - Standards
      summary: List standards
      description: Get list of all RTO compliance standards
      operationId: listStandards
      responses:
        '200':
          description: List of standards
          content:
            application/json:
              schema:
                type: object
                properties:
                  standards:
                    type: array
                    items:
                      $ref: '#/components/schemas/Standard'
                      
  /api/v1/standards/{id}/mappings:
    get:
      tags:
        - Standards
      summary: Get standard mappings
      description: Get all policies, SOPs, and evidence mapped to a standard
      operationId: getStandardMappings
      parameters:
        - $ref: '#/components/parameters/IdParam'
      responses:
        '200':
          description: Standard mappings
          content:
            application/json:
              schema:
                type: object
                properties:
                  standard:
                    $ref: '#/components/schemas/Standard'
                  policies:
                    type: array
                    items:
                      $ref: '#/components/schemas/Policy'
                  sops:
                    type: array
                    items:
                      $ref: '#/components/schemas/SOP'
                  evidence:
                    type: array
                    items:
                      $ref: '#/components/schemas/Evidence'
                      
  /api/v1/training-products:
    get:
      tags:
        - Training Products
      summary: List training products
      description: Get paginated list of training products
      operationId: listTrainingProducts
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/PerPageParam'
        - name: status
          in: query
          schema:
            type: string
            enum: [Active, Inactive]
      responses:
        '200':
          description: List of training products
          content:
            application/json:
              schema:
                type: object
                properties:
                  trainingProducts:
                    type: array
                    items:
                      $ref: '#/components/schemas/TrainingProduct'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
                    
    post:
      tags:
        - Training Products
      summary: Create training product
      description: Create a new training product
      operationId: createTrainingProduct
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TrainingProductCreate'
      responses:
        '201':
          description: Training product created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TrainingProduct'
                
  /api/v1/training-products/{id}:
    get:
      tags:
        - Training Products
      summary: Get training product
      description: Get training product details including linked SOPs and assessments
      operationId: getTrainingProduct
      parameters:
        - $ref: '#/components/parameters/IdParam'
      responses:
        '200':
          description: Training product details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TrainingProduct'
                
  /api/v1/training-products/{id}/sops:
    post:
      tags:
        - Training Products
      summary: Link SOPs to training product
      description: Link one or more SOPs to a training product
      operationId: linkSOPsToTrainingProduct
      parameters:
        - $ref: '#/components/parameters/IdParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - sopIds
              properties:
                sopIds:
                  type: array
                  items:
                    type: string
      responses:
        '200':
          description: SOPs linked successfully
          
  /api/v1/sops/{id}:
    get:
      tags:
        - SOPs
      summary: Get SOP
      description: Get SOP details
      operationId: getSOP
      parameters:
        - $ref: '#/components/parameters/IdParam'
      responses:
        '200':
          description: SOP details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SOP'
                
  /api/v1/pd:
    get:
      tags:
        - Professional Development
      summary: List PD items
      description: Get paginated list of professional development items
      operationId: listPDItems
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/PerPageParam'
        - name: userId
          in: query
          schema:
            type: string
        - name: status
          in: query
          schema:
            $ref: '#/components/schemas/PDStatus'
        - name: dueBefore
          in: query
          description: Filter items due before this date
          schema:
            type: string
            format: date
      responses:
        '200':
          description: List of PD items
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/PDItem'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
                    
    post:
      tags:
        - Professional Development
      summary: Create PD item
      description: Create a new professional development item
      operationId: createPDItem
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PDItemCreate'
      responses:
        '201':
          description: PD item created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PDItem'
                
  /api/v1/pd/{id}/complete:
    post:
      tags:
        - Professional Development
      summary: Complete PD item
      description: Mark PD item as complete with evidence
      operationId: completePDItem
      parameters:
        - $ref: '#/components/parameters/IdParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - completedAt
              properties:
                completedAt:
                  type: string
                  format: date-time
                evidenceUrl:
                  type: string
                  format: uri
                notes:
                  type: string
      responses:
        '200':
          description: PD item marked as complete
          
  /api/v1/credentials:
    get:
      tags:
        - Credentials
      summary: List credentials
      description: Get list of credentials with optional filters
      operationId: listCredentials
      parameters:
        - name: userId
          in: query
          schema:
            type: string
        - name: expiresBefore
          in: query
          description: Filter credentials expiring before this date
          schema:
            type: string
            format: date
      responses:
        '200':
          description: List of credentials
          content:
            application/json:
              schema:
                type: object
                properties:
                  credentials:
                    type: array
                    items:
                      $ref: '#/components/schemas/Credential'
                      
  /api/v1/feedback:
    get:
      tags:
        - Feedback
      summary: List feedback
      description: Get feedback submissions with filters
      operationId: listFeedback
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/PerPageParam'
        - name: type
          in: query
          schema:
            $ref: '#/components/schemas/FeedbackType'
        - name: courseId
          in: query
          schema:
            type: string
        - name: trainerId
          in: query
          schema:
            type: string
        - name: dateFrom
          in: query
          schema:
            type: string
            format: date
        - name: dateTo
          in: query
          schema:
            type: string
            format: date
        - name: anonymous
          in: query
          schema:
            type: boolean
      responses:
        '200':
          description: List of feedback submissions
          content:
            application/json:
              schema:
                type: object
                properties:
                  feedback:
                    type: array
                    items:
                      $ref: '#/components/schemas/Feedback'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
                    
  /api/v1/feedback/insights:
    get:
      tags:
        - Feedback
      summary: Get feedback insights
      description: Get aggregated metrics and AI-generated themes from feedback
      operationId: getFeedbackInsights
      parameters:
        - name: dateFrom
          in: query
          schema:
            type: string
            format: date
        - name: dateTo
          in: query
          schema:
            type: string
            format: date
      responses:
        '200':
          description: Feedback insights
          content:
            application/json:
              schema:
                type: object
                properties:
                  summary:
                    type: object
                    properties:
                      totalResponses:
                        type: integer
                      averageRating:
                        type: number
                      sentimentScore:
                        type: number
                        description: Sentiment score from -1 (negative) to 1 (positive)
                  themes:
                    type: array
                    items:
                      type: object
                      properties:
                        theme:
                          type: string
                        count:
                          type: integer
                        sentiment:
                          type: number
                          
  /api/v1/webhooks/jotform:
    post:
      tags:
        - Webhooks
      summary: JotForm webhook
      description: Receive JotForm submission via webhook
      operationId: jotformWebhook
      security: []
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              description: JotForm webhook payload (opaque)
      responses:
        '202':
          description: Webhook accepted for processing
          content:
            application/json:
              schema:
                type: object
                properties:
                  submissionId:
                    type: string
        '400':
          $ref: '#/components/responses/BadRequestError'
          
  /api/v1/assets:
    get:
      tags:
        - Assets
      summary: List assets
      description: Get paginated list of assets
      operationId: listAssets
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/PerPageParam'
        - name: type
          in: query
          schema:
            type: string
        - name: status
          in: query
          schema:
            $ref: '#/components/schemas/AssetStatus'
        - name: location
          in: query
          schema:
            type: string
      responses:
        '200':
          description: List of assets
          content:
            application/json:
              schema:
                type: object
                properties:
                  assets:
                    type: array
                    items:
                      $ref: '#/components/schemas/Asset'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
                    
    post:
      tags:
        - Assets
      summary: Create asset
      description: Create a new asset record
      operationId: createAsset
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AssetCreate'
      responses:
        '201':
          description: Asset created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Asset'
                
  /api/v1/assets/{id}:
    patch:
      tags:
        - Assets
      summary: Update asset
      description: Update asset details
      operationId: updateAsset
      parameters:
        - $ref: '#/components/parameters/IdParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AssetUpdate'
      responses:
        '200':
          description: Asset updated successfully
          
  /api/v1/assets/{id}/service:
    post:
      tags:
        - Assets
      summary: Log service event
      description: Log a service or maintenance event for an asset
      operationId: logAssetService
      parameters:
        - $ref: '#/components/parameters/IdParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - date
              properties:
                date:
                  type: string
                  format: date
                notes:
                  type: string
                documents:
                  type: array
                  items:
                    type: string
                    format: uri
      responses:
        '201':
          description: Service event logged successfully
          
  /api/v1/assets/{id}/state:
    post:
      tags:
        - Assets
      summary: Change asset state
      description: Transition asset to a new lifecycle state
      operationId: changeAssetState
      parameters:
        - $ref: '#/components/parameters/IdParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - state
              properties:
                state:
                  $ref: '#/components/schemas/AssetStatus'
      responses:
        '200':
          description: Asset state changed successfully
          
  /api/v1/complaints:
    get:
      tags:
        - Complaints
      summary: List complaints
      description: Get paginated list of complaints
      operationId: listComplaints
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/PerPageParam'
        - name: status
          in: query
          schema:
            $ref: '#/components/schemas/ComplaintStatus'
        - name: dateFrom
          in: query
          schema:
            type: string
            format: date
        - name: dateTo
          in: query
          schema:
            type: string
            format: date
      responses:
        '200':
          description: List of complaints
          content:
            application/json:
              schema:
                type: object
                properties:
                  complaints:
                    type: array
                    items:
                      $ref: '#/components/schemas/Complaint'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
                    
    post:
      tags:
        - Complaints
      summary: Create complaint
      description: Create a new complaint record
      operationId: createComplaint
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ComplaintCreate'
      responses:
        '201':
          description: Complaint created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Complaint'
                
  /api/v1/complaints/{id}:
    patch:
      tags:
        - Complaints
      summary: Update complaint
      description: Update complaint status and details
      operationId: updateComplaint
      parameters:
        - $ref: '#/components/parameters/IdParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ComplaintUpdate'
      responses:
        '200':
          description: Complaint updated successfully
          
  /api/v1/complaints/{id}/close:
    post:
      tags:
        - Complaints
      summary: Close complaint
      description: Close a complaint with resolution details
      operationId: closeComplaint
      parameters:
        - $ref: '#/components/parameters/IdParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - rootCause
                - correctiveAction
              properties:
                rootCause:
                  type: string
                correctiveAction:
                  type: string
      responses:
        '200':
          description: Complaint closed successfully
          
  /api/v1/sync/xero:
    post:
      tags:
        - Integrations
      summary: Trigger Xero sync
      description: Manually trigger synchronization with Xero
      operationId: triggerXeroSync
      responses:
        '202':
          description: Sync job queued
          content:
            application/json:
              schema:
                type: object
                properties:
                  jobId:
                    type: string
                  message:
                    type: string
                    
  /api/v1/sync/accelerate:
    post:
      tags:
        - Integrations
      summary: Trigger Accelerate sync
      description: Manually trigger synchronization with Accelerate
      operationId: triggerAccelerateSync
      responses:
        '202':
          description: Sync job queued
          
  /api/v1/files/google-drive/upload:
    post:
      tags:
        - Integrations
      summary: Upload to Google Drive
      description: Upload a file to Google Drive
      operationId: uploadToGoogleDrive
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - file
              properties:
                file:
                  type: string
                  format: binary
                folderId:
                  type: string
                  description: Google Drive folder ID
      responses:
        '201':
          description: File uploaded successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  fileId:
                    type: string
                  webViewLink:
                    type: string
                    format: uri
                    
  /api/v1/jobs:
    get:
      tags:
        - Jobs
      summary: List jobs
      description: Get list of scheduled and background jobs
      operationId: listJobs
      responses:
        '200':
          description: List of jobs
          content:
            application/json:
              schema:
                type: object
                properties:
                  jobs:
                    type: array
                    items:
                      $ref: '#/components/schemas/Job'
                      
  /api/v1/jobs/run:
    post:
      tags:
        - Jobs
      summary: Trigger job
      description: Manually trigger a named job
      operationId: triggerJob
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
              properties:
                name:
                  type: string
                  enum: [syncXero, syncAccelerate, pdReminders, policyReviews]
      responses:
        '202':
          description: Job queued
          
  /api/v1/audit-logs:
    get:
      tags:
        - Audit Logs
      summary: List audit logs
      description: Get paginated list of audit log entries
      operationId: listAuditLogs
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/PerPageParam'
        - name: userId
          in: query
          schema:
            type: string
        - name: action
          in: query
          schema:
            type: string
        - name: entityType
          in: query
          schema:
            type: string
        - name: dateFrom
          in: query
          schema:
            type: string
            format: date-time
        - name: dateTo
          in: query
          schema:
            type: string
            format: date-time
      responses:
        '200':
          description: List of audit logs
          content:
            application/json:
              schema:
                type: object
                properties:
                  logs:
                    type: array
                    items:
                      $ref: '#/components/schemas/AuditLog'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
                    
  /health:
    get:
      tags:
        - Monitoring
      summary: Health check
      description: Check API health status
      operationId: healthCheck
      security: []
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: healthy
                  timestamp:
                    type: string
                    format: date-time
                  uptime:
                    type: number
                  database:
                    type: string
                    example: connected
                  version:
                    type: string
        '503':
          description: Service is unhealthy
          
  /metrics:
    get:
      tags:
        - Monitoring
      summary: Prometheus metrics
      description: Get Prometheus-formatted metrics
      operationId: getMetrics
      security: []
      responses:
        '200':
          description: Metrics in Prometheus format
          content:
            text/plain:
              schema:
                type: string

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT authentication token obtained from /api/v1/auth/login

  parameters:
    IdParam:
      name: id
      in: path
      required: true
      description: Resource ID (UUID)
      schema:
        type: string
        format: uuid
        
    PageParam:
      name: page
      in: query
      description: Page number (1-indexed)
      schema:
        type: integer
        minimum: 1
        default: 1
        
    PerPageParam:
      name: perPage
      in: query
      description: Items per page
      schema:
        type: integer
        minimum: 1
        maximum: 100
        default: 30

  schemas:
    # User schemas
    User:
      type: object
      required:
        - id
        - name
        - email
        - department
        - roles
        - status
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
          example: John Smith
        email:
          type: string
          format: email
          example: john.smith@rto.com.au
        department:
          $ref: '#/components/schemas/Department'
        roles:
          type: array
          items:
            $ref: '#/components/schemas/Role'
        status:
          $ref: '#/components/schemas/UserStatus'
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
          
    UserCreate:
      type: object
      required:
        - name
        - email
        - password
        - department
        - roles
      properties:
        name:
          type: string
        email:
          type: string
          format: email
        password:
          type: string
          format: password
          minLength: 8
        department:
          $ref: '#/components/schemas/Department'
        roles:
          type: array
          items:
            $ref: '#/components/schemas/Role'
            
    UserUpdate:
      type: object
      properties:
        name:
          type: string
        email:
          type: string
          format: email
        department:
          $ref: '#/components/schemas/Department'
        roles:
          type: array
          items:
            $ref: '#/components/schemas/Role'
        status:
          $ref: '#/components/schemas/UserStatus'
          
    Department:
      type: string
      enum: [Training, Admin, Management, Support]
      
    Role:
      type: string
      enum: [Trainer, SystemAdmin, ComplianceAdmin, Manager, Staff]
      
    UserStatus:
      type: string
      enum: [Active, Inactive]
      
    # Policy schemas
    Policy:
      type: object
      required:
        - id
        - title
        - version
        - status
      properties:
        id:
          type: string
          format: uuid
        title:
          type: string
          example: Student Welfare Policy
        version:
          type: string
          example: "2.1"
        ownerId:
          type: string
          format: uuid
        status:
          $ref: '#/components/schemas/PolicyStatus'
        reviewDate:
          type: string
          format: date
        fileUrl:
          type: string
          format: uri
        mappedStandardIds:
          type: array
          items:
            type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
          
    PolicyCreate:
      type: object
      required:
        - title
        - version
        - fileUrl
      properties:
        title:
          type: string
        version:
          type: string
        ownerId:
          type: string
          format: uuid
        reviewDate:
          type: string
          format: date
        fileUrl:
          type: string
          format: uri
          
    PolicyUpdate:
      type: object
      properties:
        title:
          type: string
        ownerId:
          type: string
          format: uuid
        reviewDate:
          type: string
          format: date
        status:
          $ref: '#/components/schemas/PolicyStatus'
          
    PolicyStatus:
      type: string
      enum: [Draft, Published, Archived]
      
    PolicyVersion:
      type: object
      properties:
        version:
          type: string
        publishedAt:
          type: string
          format: date-time
        publishedBy:
          type: string
        fileUrl:
          type: string
          format: uri
          
    # Standard schemas
    Standard:
      type: object
      required:
        - id
        - title
        - clause
      properties:
        id:
          type: string
          example: STD-1
        title:
          type: string
          example: Training and assessment
        clause:
          type: string
          example: "1.1"
        description:
          type: string
          
    # Training Product schemas
    TrainingProduct:
      type: object
      required:
        - id
        - code
        - name
        - status
      properties:
        id:
          type: string
          format: uuid
        code:
          type: string
          example: TLI41221
        name:
          type: string
          example: Certificate IV in Transport and Logistics
        status:
          type: string
          enum: [Active, Inactive]
        sopIds:
          type: array
          items:
            type: string
            format: uuid
        assessmentStrategyUrl:
          type: string
          format: uri
        createdAt:
          type: string
          format: date-time
          
    TrainingProductCreate:
      type: object
      required:
        - code
        - name
      properties:
        code:
          type: string
        name:
          type: string
        assessmentStrategyUrl:
          type: string
          format: uri
          
    # SOP schemas
    SOP:
      type: object
      required:
        - id
        - title
        - version
      properties:
        id:
          type: string
          format: uuid
        title:
          type: string
          example: Learner Assessment Procedure
        policyId:
          type: string
          format: uuid
        version:
          type: string
        fileUrl:
          type: string
          format: uri
          
    # Professional Development schemas
    PDItem:
      type: object
      required:
        - id
        - userId
        - title
        - status
      properties:
        id:
          type: string
          format: uuid
        userId:
          type: string
          format: uuid
        title:
          type: string
          example: Attend TAE Training
        hours:
          type: number
          nullable: true
        dueAt:
          type: string
          format: date-time
        status:
          $ref: '#/components/schemas/PDStatus'
        evidenceUrl:
          type: string
          format: uri
          nullable: true
        completedAt:
          type: string
          format: date-time
          nullable: true
        createdAt:
          type: string
          format: date-time
          
    PDItemCreate:
      type: object
      required:
        - userId
        - title
        - dueAt
      properties:
        userId:
          type: string
          format: uuid
        title:
          type: string
        hours:
          type: number
        dueAt:
          type: string
          format: date-time
          
    PDStatus:
      type: string
      enum: [Planned, Due, Overdue, Completed, Verified]
      
    # Credential schemas
    Credential:
      type: object
      required:
        - id
        - userId
        - name
        - issuedAt
      properties:
        id:
          type: string
          format: uuid
        userId:
          type: string
          format: uuid
        name:
          type: string
          example: Certificate IV in Training and Assessment
        issuedAt:
          type: string
          format: date
        expiresAt:
          type: string
          format: date
          nullable: true
        evidenceUrl:
          type: string
          format: uri
          
    CredentialCreate:
      type: object
      required:
        - name
        - issuedAt
      properties:
        name:
          type: string
        issuedAt:
          type: string
          format: date
        expiresAt:
          type: string
          format: date
        evidenceUrl:
          type: string
          format: uri
          
    # Feedback schemas
    Feedback:
      type: object
      required:
        - id
        - type
        - anonymous
      properties:
        id:
          type: string
          format: uuid
        type:
          $ref: '#/components/schemas/FeedbackType'
        courseId:
          type: string
          nullable: true
        trainerId:
          type: string
          nullable: true
        rating:
          type: number
          minimum: 0
          maximum: 5
        comments:
          type: string
          nullable: true
        anonymous:
          type: boolean
        createdAt:
          type: string
          format: date-time
          
    FeedbackType:
      type: string
      enum: [learner, employer, industry]
      
    # Asset schemas
    Asset:
      type: object
      required:
        - id
        - type
        - name
        - status
      properties:
        id:
          type: string
          format: uuid
        type:
          type: string
          example: Crane
        name:
          type: string
          example: Mobile Crane #1
        location:
          type: string
          example: Training Yard A
        status:
          $ref: '#/components/schemas/AssetStatus'
        lastServiceAt:
          type: string
          format: date
          nullable: true
        documents:
          type: array
          items:
            type: string
            format: uri
        createdAt:
          type: string
          format: date-time
          
    AssetCreate:
      type: object
      required:
        - type
        - name
      properties:
        type:
          type: string
        name:
          type: string
        location:
          type: string
          
    AssetUpdate:
      type: object
      properties:
        name:
          type: string
        location:
          type: string
        status:
          $ref: '#/components/schemas/AssetStatus'
          
    AssetStatus:
      type: string
      enum: [Available, Assigned, Servicing, Retired]
      
    # Complaint schemas
    Complaint:
      type: object
      required:
        - id
        - source
        - description
        - status
      properties:
        id:
          type: string
          format: uuid
        source:
          type: string
          example: Student
        description:
          type: string
        status:
          $ref: '#/components/schemas/ComplaintStatus'
        studentId:
          type: string
          nullable: true
        trainerId:
          type: string
          nullable: true
        courseId:
          type: string
          nullable: true
        rootCause:
          type: string
          nullable: true
        correctiveAction:
          type: string
          nullable: true
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
          
    ComplaintCreate:
      type: object
      required:
        - source
        - description
      properties:
        source:
          type: string
        description:
          type: string
        studentId:
          type: string
        trainerId:
          type: string
        courseId:
          type: string
          
    ComplaintUpdate:
      type: object
      properties:
        status:
          $ref: '#/components/schemas/ComplaintStatus'
        notes:
          type: string
        rootCause:
          type: string
        correctiveAction:
          type: string
          
    ComplaintStatus:
      type: string
      enum: [New, InReview, Actioned, Closed]
      
    # Evidence schema
    Evidence:
      type: object
      required:
        - id
        - entityType
        - entityId
        - url
      properties:
        id:
          type: string
          format: uuid
        entityType:
          type: string
          example: policy
        entityId:
          type: string
        url:
          type: string
          format: uri
        description:
          type: string
          nullable: true
          
    # Job schema
    Job:
      type: object
      required:
        - name
        - status
      properties:
        name:
          type: string
        status:
          type: string
          enum: [scheduled, running, completed, failed]
        nextRunAt:
          type: string
          format: date-time
          nullable: true
        lastRunAt:
          type: string
          format: date-time
          nullable: true
          
    # Audit Log schema
    AuditLog:
      type: object
      required:
        - id
        - userId
        - action
        - entityType
        - timestamp
      properties:
        id:
          type: string
          format: uuid
        userId:
          type: string
          format: uuid
        action:
          type: string
          example: login_attempt
        entityType:
          type: string
          example: user
        entityId:
          type: string
          nullable: true
        details:
          type: object
          additionalProperties: true
        timestamp:
          type: string
          format: date-time
        ipAddress:
          type: string
          nullable: true
          
    # Pagination schema
    Pagination:
      type: object
      required:
        - page
        - perPage
        - total
        - totalPages
      properties:
        page:
          type: integer
          example: 1
        perPage:
          type: integer
          example: 30
        total:
          type: integer
          example: 156
        totalPages:
          type: integer
          example: 6
          
    # Error schemas
    ProblemDetails:
      type: object
      required:
        - type
        - title
        - status
      properties:
        type:
          type: string
          format: uri
          example: https://tools.ietf.org/html/rfc7231#section-6.5.1
        title:
          type: string
          example: Bad Request
        status:
          type: integer
          example: 400
        detail:
          type: string
          example: Validation failed for request body
        instance:
          type: string
          example: /api/v1/users
        errors:
          type: array
          items:
            type: object
            properties:
              field:
                type: string
              message:
                type: string

  responses:
    BadRequestError:
      description: Bad Request - Invalid input
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ProblemDetails'
          example:
            type: https://tools.ietf.org/html/rfc7231#section-6.5.1
            title: Bad Request
            status: 400
            detail: Validation failed
            
    UnauthorizedError:
      description: Unauthorized - Invalid or missing authentication
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ProblemDetails'
          example:
            type: https://tools.ietf.org/html/rfc7231#section-6.5.1
            title: Unauthorized
            status: 401
            detail: Invalid or expired authentication token
            
    ForbiddenError:
      description: Forbidden - Insufficient permissions
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ProblemDetails'
          example:
            type: https://tools.ietf.org/html/rfc7231#section-6.5.3
            title: Forbidden
            status: 403
            detail: Insufficient permissions to access this resource
            
    NotFoundError:
      description: Not Found - Resource does not exist
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ProblemDetails'
          example:
            type: https://tools.ietf.org/html/rfc7231#section-6.5.4
            title: Not Found
            status: 404
            detail: The requested resource was not found
            
    TooManyRequestsError:
      description: Too Many Requests - Rate limit exceeded
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ProblemDetails'
          example:
            type: https://tools.ietf.org/html/rfc6585#section-4
            title: Too Many Requests
            status: 429
            detail: Rate limit exceeded. Please try again later
